<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>××¢×¨×›×ª ××¢×§×‘ ×›×•×—×•×ª</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
Â  Â  <style>
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  background: #1a1a1a;
Â  Â  Â  Â  }

Â  Â  Â  Â  #loading {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: #1a1a1a;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  }

Â  Â  Â  Â  #loading.hidden {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  flex-direction: row-reverse;
Â  Â  Â  Â  }

Â  Â  Â  Â  #map {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: #e0e0e0;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  #sidebar {
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  background: #2c3e50;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  box-shadow: -2px 0 10px rgba(0,0,0,0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  #map {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: #e0e0e0;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  h2 {
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #3498db;
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-item {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-item:hover {
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  transform: translateX(-5px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-item.active {
Â  Â  Â  Â  Â  Â  background: #27ae60;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-checkbox {
Â  Â  Â  Â  Â  Â  width: 20px;
Â  Â  Â  Â  Â  Â  height: 20px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-info {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  margin: 0 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-name {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-count {
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  color: #bdc3c7;
Â  Â  Â  Â  Â  Â  margin-top: 4px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .color-indicator {
Â  Â  Â  Â  Â  Â  width: 24px;
Â  Â  Â  Â  Â  Â  height: 24px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 2px solid white;
Â  Â  Â  Â  }

Â  Â  Â  Â  #status {
Â  Â  Â  Â  Â  Â  background: #27ae60;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  #status.disconnected {
Â  Â  Â  Â  Â  Â  background: #e74c3c;
Â  Â  Â  Â  }

Â  Â  Â  Â  #status.connecting {
Â  Â  Â  Â  Â  Â  background: #f39c12;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-marker {
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .custom-icon {
Â  Â  Â  Â  Â  Â  width: 30px;
Â  Â  Â  Â  Â  Â  height: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: 3px solid white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .leaflet-popup-content {
Â  Â  Â  Â  Â  Â  text-align: right;
Â  Â  Â  Â  Â  Â  direction: rtl;
Â  Â  Â  Â  Â  Â  min-width: 200px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #connection-info {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #test-buttons {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #test-buttons button {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #test-buttons button:hover {
Â  Â  Â  Â  Â  Â  background: #2980b9;
Â  Â  Â  Â  }

Â  Â  Â  Â  #error-message {
Â  Â  Â  Â  Â  Â  background: #e74c3c;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #location-bar {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 300px;
Â  Â  Â  Â  Â  Â  background: rgba(44, 62, 80, 0.95);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #location-info {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .info-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .info-label {
Â  Â  Â  Â  Â  Â  color: #95a5a6;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  .info-value {
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  font-family: monospace;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0, 0, 0, 0.8);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 10000;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-overlay.hidden {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box {
Â  Â  Â  Â  Â  Â  background: #2c3e50;
Â  Â  Â  Â  Â  Â  padding: 40px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  min-width: 350px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box h2 {
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box input {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  border: 2px solid #34495e;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box input:focus {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: #3498db;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box button {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-box button:hover {
Â  Â  Â  Â  Â  Â  background: #2980b9;
Â  Â  Â  Â  }

Â  Â  Â  Â  #login-error {
Â  Â  Â  Â  Â  Â  color: #e74c3c;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .admin-only {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .admin-badge {
Â  Â  Â  Â  Â  Â  background: #e74c3c;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 5px 10px;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  #logout-btn {
Â  Â  Â  Â  Â  Â  background: #e74c3c;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #logout-btn:hover {
Â  Â  Â  Â  Â  Â  background: #c0392b;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-header:hover {
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-header.active {
Â  Â  Â  Â  Â  Â  background: #27ae60;
Â  Â  Â  Â  }

Â  Â  Â  Â  .layer-toggle {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-list {
Â  Â  Â  Â  Â  Â  margin-left: 20px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  max-height: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  transition: max-height 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-list.expanded {
Â  Â  Â  Â  Â  Â  max-height: 500px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-item {
Â  Â  Â  Â  Â  Â  background: #2c3e50;
Â  Â  Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  Â  Â  margin: 5px 0;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  border-left: 3px solid;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-item:hover {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  transform: translateX(-3px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-item-name {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 3px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .force-item-id {
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  color: #95a5a6;
Â  Â  Â  Â  }

Â  Â  Â  Â  #map-overlay {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #selection-message {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  .selecting-mode {
Â  Â  Â  Â  Â  Â  cursor: crosshair !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  .selecting-mode * {
Â  Â  Â  Â  Â  Â  cursor: crosshair !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  #map-instruction {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 20px;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  background: rgba(52, 152, 219, 0.95);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
Â  Â  Â  Â  Â  Â  z-index: 2000;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  animation: slideDown 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  #map-instruction.active {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes slideDown {
Â  Â  Â  Â  Â  Â  from {
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(-50%) translateY(-20px);
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  to {
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(-50%) translateY(0);
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  .prediction-controls {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin: 10px 0;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .prediction-controls label {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  .prediction-controls input[type="checkbox"] {
Â  Â  Â  Â  Â  Â  width: 18px;
Â  Â  Â  Â  Â  Â  height: 18px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  .prediction-controls input[type="range"] {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .prediction-info {
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  color: #95a5a6;
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #add-force-modal, #add-deadzone-modal {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  background: #2c3e50;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  z-index: 10001;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  min-width: 400px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #add-force-modal.active, #add-deadzone-modal.active {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-header {
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #3498db;
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-field {
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-field label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-field input, .modal-field select {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: 2px solid #34495e;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-field input:focus, .modal-field select:focus {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: #3498db;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-buttons {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-buttons button {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background: #3498db;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary:hover {
Â  Â  Â  Â  Â  Â  background: #2980b9;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background: #95a5a6;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  Â  Â  background: #7f8c8d;
Â  Â  Â  Â  }

Â  Â  Â  Â  .location-preview {
Â  Â  Â  Â  Â  Â  background: #34495e;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-family: monospace;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  color: #ecf0f1;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="login-overlay">
Â  Â  Â  Â  <div id="login-box">
Â  Â  Â  Â  Â  Â  <h2>ğŸ” ×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª</h2>
Â  Â  Â  Â  Â  Â  <input type="text" id="username-input" placeholder="×©× ××©×ª××©" />
Â  Â  Â  Â  Â  Â  <input type="password" id="password-input" placeholder="×¡×™×¡××”" />
Â  Â  Â  Â  Â  Â  <button onclick="login()">×”×ª×—×‘×¨</button>
Â  Â  Â  Â  Â  Â  <button onclick="viewAsGuest()" style="background: #95a5a6; margin-top: 10px;">×›× ×™×¡×” ×›××•×¨×— (×¦×¤×™×™×” ×‘×œ×‘×“)</button>
Â  Â  Â  Â  Â  Â  <div id="login-error"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="loading">â³ ×˜×•×¢×Ÿ ××¤×”...</div>
Â  Â Â 
Â  Â  <div id="container" style="display: none;">
Â  Â  Â  Â  <div id="map"></div>
Â  Â  Â  Â  <div id="sidebar">
Â  Â  Â  Â  Â  Â  <div id="error-message"></div>
Â  Â  Â  Â  Â  Â  <div id="status" class="connecting">××ª×—×‘×¨ ×œ×©×¨×ª...</div>
Â  Â  Â  Â  Â  Â  <div id="connection-info">
Â  Â  Â  Â  Â  Â  Â  Â  <div>×©×¨×ª: <span id="server-url">https://deadzonesaver-production.up.railway.app/</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>××—×•×‘×¨: <span id="connected-status">×œ×</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="user-status">××©×ª××©: <span id="current-user">××•×¨×—</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="logout-btn" style="display: none;" onclick="logout()">×”×ª× ×ª×§</button>
Â  Â  Â  Â  Â  Â  <h2>×©×›×‘×•×ª ×›×•×—×•×ª</h2>
Â  Â  Â  Â  Â  Â  <div id="layers"></div>
Â  Â  Â  Â  Â  Â  <div id="test-buttons" class="admin-only">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openAddForceModal()">â• ×”×•×¡×£ ×›×•×— ×™×“× ×™</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openAddDeadZoneModal()">â˜¢ï¸ ×”×•×¡×£ Dead Zone ×™×“× ×™</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="clearAllForces()">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="prediction-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="show-predictions" checked onchange="togglePredictions()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”® ×”×¦×’ ×—×™×–×•×™×™ ××¡×œ×•×œ
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="prediction-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>×–××Ÿ ×—×™×–×•×™: <span id="prediction-time-label">60</span> ×©× ×™×•×ª</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="prediction-time" min="30" max="300" value="60" step="30"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oninput="updatePredictionTime(this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="location-bar">
Â  Â  Â  Â  Â  Â  <div id="location-info">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-label">ğŸ“ ×§×•××•×¨×“×™× ×˜×•×ª:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-value" id="mouse-coords">---, ---</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-label">ğŸ“Œ ××™×§×•×:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-value" id="location-name">×”×¢×‘×¨ ×¢×›×‘×¨ ×¢×œ ×”××¤×”</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-label">ğŸ—ºï¸ ×–×•×:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="info-value" id="zoom-level">8</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- ×”×•×“×¢×” ×§×˜× ×” ×œ××¢×œ×” -->
Â  Â  <div id="map-instruction"></div>

Â  Â  <!-- Modal ×œ×”×•×¡×¤×ª ×›×•×— -->
Â  Â  <div id="add-force-modal">
Â  Â  Â  Â  <div class="modal-header">â• ×”×•×¡×¤×ª ×›×•×— ×—×“×©</div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>×©× ×”×›×•×—:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="force-name-input" placeholder="×œ×“×•×’××”: ×’×“×•×“ 1" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>×¡×•×’ ×”×›×•×—:</label>
Â  Â  Â  Â  Â  Â  <select id="force-type-input">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="infantry">×›×•×—×•×ª ×—×™"×¨</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="armor">×›×•×—×•×ª ×©×¨×™×•×Ÿ</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="artillery">×ª×•×ª×—× ×™×</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="other">××—×¨</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>××™×§×•× (×œ×—×¥ ×¢×œ "×‘×—×¨ ×‘××¤×”"):</label>
Â  Â  Â  Â  Â  Â  <button onclick="selectLocationOnMap('force')" class="btn-primary" style="width: 100%;">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ ×‘×—×¨ ××™×§×•× ×‘××¤×”
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <div id="force-location-preview" class="location-preview" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  ××™×§×•× × ×‘×—×¨: <span id="force-lat">-</span>, <span id="force-lng">-</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="submitForce()">âœ“ ×”×•×¡×£</button>
Â  Â  Â  Â  Â  Â  <button class="btn-secondary" onclick="closeAddForceModal()">âœ— ×‘×™×˜×•×œ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Modal ×œ×”×•×¡×¤×ª Dead Zone -->
Â  Â  <div id="add-deadzone-modal">
Â  Â  Â  Â  <div class="modal-header">â˜¢ï¸ ×”×•×¡×¤×ª Dead Zone</div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>×©× ×”××–×•×¨:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="deadzone-name-input" placeholder="×œ×“×•×’××”: ××–×•×¨ ××¡×•×›×Ÿ" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>×¨×“×™×•×¡ (××˜×¨×™×):</label>
Â  Â  Â  Â  Â  Â  <input type="number" id="deadzone-radius-input" placeholder="2000" value="2000" min="100" max="50000" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>×ª×™××•×¨ (××•×¤×¦×™×•× ×œ×™):</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="deadzone-description-input" placeholder="××–×•×¨ ××¡×•×¨ ×œ×—×“×™×¨×”" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-field">
Â  Â  Â  Â  Â  Â  <label>××™×§×•× ××¨×›×– (×œ×—×¥ ×¢×œ "×‘×—×¨ ×‘××¤×”"):</label>
Â  Â  Â  Â  Â  Â  <button onclick="selectLocationOnMap('deadzone')" class="btn-primary" style="width: 100%;">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ ×‘×—×¨ ××™×§×•× ×‘××¤×”
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <div id="deadzone-location-preview" class="location-preview" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  ××™×§×•× × ×‘×—×¨: <span id="deadzone-lat">-</span>, <span id="deadzone-lng">-</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="submitDeadZone()">âœ“ ×”×•×¡×£</button>
Â  Â  Â  Â  Â  Â  <button class="btn-secondary" onclick="closeAddDeadZoneModal()">âœ— ×‘×™×˜×•×œ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
Â  Â  <script>
Â  Â  Â  Â  console.log('ğŸš€ Starting Force Tracking System...');
Â  Â  Â  Â  console.log('Leaflet version:', typeof L !== 'undefined' ? 'loaded' : 'NOT loaded');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const SERVER_URL = window.location.origin;
Â  Â  Â  Â  let map;
Â  Â  Â  Â  let markers = {};
Â  Â  Â  Â  let stompClient = null;
Â  Â  Â  Â  let isAdmin = false;
Â  Â  Â  Â  let currentUser = 'guest';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // × ×ª×•× ×™ ××“××™×Ÿ (×‘×¤×¨×•×“×§×©×Ÿ - ×–×” ×¦×¨×™×š ×œ×”×™×•×ª ×‘×©×¨×ª!)
Â  Â  Â  Â  const ADMIN_CREDENTIALS = {
Â  Â  Â  Â  Â  Â  username: 'admin',
Â  Â  Â  Â  Â  Â  password: 'admin123'
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  let layers = {
Â  Â  Â  Â  Â  Â  'infantry': { name: '×›×•×—×•×ª ×—×™"×¨', color: '#e74c3c', visible: true, markers: [], icon: 'ğŸ‘¥', expanded: true },
Â  Â  Â  Â  Â  Â  'armor': { name: '×›×•×—×•×ª ×©×¨×™×•×Ÿ', color: '#3498db', visible: true, markers: [], icon: 'ğŸ›¡ï¸', expanded: true },
Â  Â  Â  Â  Â  Â  'artillery': { name: '×ª×•×ª×—× ×™×', color: '#f39c12', visible: true, markers: [], icon: 'ğŸ’£', expanded: true },
Â  Â  Â  Â  Â  Â  'other': { name: '××—×¨', color: '#95a5a6', visible: true, markers: [], icon: 'ğŸ“¦', expanded: true },
Â  Â  Â  Â  Â  Â  'deadzone': { name: 'Dead Zones', color: '#ff0000', visible: true, markers: [], icon: 'â˜¢ï¸', expanded: true }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  let deadzones = {};
Â  Â  Â  Â  let isSelectingLocation = false;
Â  Â  Â  Â  let locationCallback = null;
Â  Â  Â  Â  let predictionLines = {};Â  // ×§×•×•×™ ×—×™×–×•×™
Â  Â  Â  Â  let showPredictions = true; // ×”×¦×’/×”×¡×ª×¨ ×—×™×–×•×™×™×

Â  Â  Â  Â  function showError(message) {
Â  Â  Â  Â  Â  Â  const errorDiv = document.getElementById('error-message');
Â  Â  Â  Â  Â  Â  errorDiv.textContent = 'âŒ ' + message;
Â  Â  Â  Â  Â  Â  errorDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  console.error(message);
Â  Â  Â  Â  }

Â  Â  Â  Â  function hideLoading() {
Â  Â  Â  Â  Â  Â  document.getElementById('loading').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('container').style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  function login() {
Â  Â  Â  Â  Â  Â  const username = document.getElementById('username-input').value;
Â  Â  Â  Â  Â  Â  const password = document.getElementById('password-input').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
Â  Â  Â  Â  Â  Â  Â  Â  isAdmin = true;
Â  Â  Â  Â  Â  Â  Â  Â  currentUser = username;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login-overlay').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-user').innerHTML = '<span class="admin-badge">××“××™×Ÿ</span> ' + username;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('logout-btn').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¦×’ ×›×¤×ª×•×¨×™ ××“××™×Ÿ
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.admin-only').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… ×”×ª×—×‘×¨×•×ª ×›××“××™×Ÿ ×”×¦×œ×™×—×”');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login-error').textContent = '×©× ××©×ª××© ××• ×¡×™×¡××” ×©×’×•×™×™×';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login-error').style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function viewAsGuest() {
Â  Â  Â  Â  Â  Â  isAdmin = false;
Â  Â  Â  Â  Â  Â  currentUser = 'guest';
Â  Â  Â  Â  Â  Â  document.getElementById('login-overlay').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('current-user').textContent = '××•×¨×— (×¦×¤×™×™×” ×‘×œ×‘×“)';
Â  Â  Â  Â  Â  Â  console.log('ğŸ‘ï¸ ×›× ×™×¡×” ×›××•×¨×—');
Â  Â  Â  Â  }

Â  Â  Â  Â  function logout() {
Â  Â  Â  Â  Â  Â  isAdmin = false;
Â  Â  Â  Â  Â  Â  currentUser = 'guest';
Â  Â  Â  Â  Â  Â  document.getElementById('current-user').textContent = '××•×¨×— (×¦×¤×™×™×” ×‘×œ×‘×“)';
Â  Â  Â  Â  Â  Â  document.getElementById('logout-btn').style.display = 'none';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×¡×ª×¨ ×›×¤×ª×•×¨×™ ××“××™×Ÿ
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.admin-only').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.style.display = 'none';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log('ğŸšª ×”×ª× ×ª×§×•×ª ××”××¢×¨×›×ª');
Â  Â  Â  Â  }

Â  Â  Â  Â  function initMap() {
Â  Â  Â  Â  Â  Â  console.log('ğŸ—ºï¸ Initializing map...');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (typeof L === 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Leaflet library not loaded!');
Â  Â  Â  Â  Â  Â  Â  Â  showError('×¡×¤×¨×™×™×ª ×”××¤×•×ª ×œ× × ×˜×¢× ×”. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜.');
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('Creating map object...');
Â  Â  Â  Â  Â  Â  Â  Â  map = L.map('map', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  center: [32.0853, 34.7818],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoom: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoomControl: true
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  console.log('Adding tile layers...');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×©×›×‘×ª ××¤×” ×¨×’×™×œ×” (×‘×¨×™×¨×ª ××—×“×œ)
Â  Â  Â  Â  Â  Â  Â  Â  const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attribution: 'Â© OpenStreetMap',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxZoom: 18,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minZoom: 3
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×©×›×‘×ª ×œ×•×•×™×™×Ÿ
Â  Â  Â  Â  Â  Â  Â  Â  const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attribution: 'Â© Esri',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxZoom: 18,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minZoom: 3
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×©×›×‘×ª ×”×™×‘×¨×™×“×™×ª (×œ×•×•×™×™×Ÿ + ×©××•×ª)
Â  Â  Â  Â  Â  Â  Â  Â  const hybridLayer = L.layerGroup([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  satelliteLayer,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxZoom: 18
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×•×¡×£ ××ª ×”××¤×” ×”×¨×’×™×œ×” ×›×‘×¨×™×¨×ª ××—×“×œ
Â  Â  Â  Â  Â  Â  Â  Â  streetLayer.addTo(map);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×‘×§×¨ ×©×›×‘×•×ª
Â  Â  Â  Â  Â  Â  Â  Â  const baseMaps = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ğŸ—ºï¸ ××¤×” ×¨×’×™×œ×”": streetLayer,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ğŸ›°ï¸ ×œ×•×•×™×™×Ÿ": satelliteLayer,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ğŸŒ ×œ×•×•×™×™×Ÿ + ×ª×•×•×™×•×ª": hybridLayer
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  L.control.layers(baseMaps).addTo(map);

Â  Â  Â  Â  Â  Â  Â  Â  // ××™×¨×•×¢ ×©××ª×¨×—×© ×›×©×”××¤×” × ×˜×¢× ×ª
Â  Â  Â  Â  Â  Â  Â  Â  map.on('load', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Map tiles loaded successfully');
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // ×›×¤×” render ×©×œ ×”××¤×”
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.invalidateSize();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Map size invalidated');
Â  Â  Â  Â  Â  Â  Â  Â  }, 100);

Â  Â  Â  Â  Â  Â  Â  Â  // ×”×•×¡×¤×ª ××¢×§×‘ ××—×¨×™ ×¢×›×‘×¨
Â  Â  Â  Â  Â  Â  Â  Â  map.on('mousemove', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lat = e.latlng.lat.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lng = e.latlng.lng.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mouse-coords').textContent = `${lat}, ${lng}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ×§×‘×œ×ª ×©× ××™×§×•× (Reverse Geocoding)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateLocationName(e.latlng.lat, e.latlng.lng);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // ×¢×“×›×•×Ÿ ×¨××ª ×–×•×
Â  Â  Â  Â  Â  Â  Â  Â  map.on('zoomend', function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('zoom-level').textContent = map.getZoom();
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Map initialized successfully');
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  Â  Â  Â  Â  connectToServer();
Â  Â  Â  Â  Â  Â  Â  Â  loadExistingForces();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Map initialization error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×˜×¢×™× ×ª ×”××¤×”: ' + error.message);
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function connectToServer() {
Â  Â  Â  Â  Â  Â  console.log('ğŸ”Œ Connecting to server:', SERVER_URL);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×‘×“×™×§×” ×× ×”×©×¨×ª ×–××™×Ÿ ×œ×¤× ×™ ×—×™×‘×•×¨ WebSocket
Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/forces/health')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Server not responding');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Server is alive, connecting to WebSocket...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  connectWebSocket();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Server is not responding:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('disconnected', '×©×¨×ª ×œ× ×–××™×Ÿ âš ï¸');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showError('×”×©×¨×ª ×œ× ×¨×¥. ×•×“× ×©×”×©×¨×ª ×¤×•×¢×œ ×¢×œ http://localhost:8080');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(connectToServer, 5000);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function connectWebSocket() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const socket = new SockJS(SERVER_URL + '/ws');
Â  Â  Â  Â  Â  Â  Â  Â  stompClient = Stomp.over(socket);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  stompClient.debug = function(str) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('STOMP:', str);
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  stompClient.connect({}, function(frame) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Connected to WebSocket:', frame);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('connected', '××—×•×‘×¨ ×œ×©×¨×ª âœ“');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('connected-status').textContent = '×›×Ÿ âœ“';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stompClient.subscribe('/topic/locations', function(message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“ Received location update');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const location = JSON.parse(message.body);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addForce(location.id, location.latitude, location.longitude,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location.type, location.name);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stompClient.subscribe('/topic/removed', function(message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ—‘ï¸ Force removed:', message.body);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const forceId = message.body;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removeForce(forceId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stompClient.subscribe('/topic/deadzones', function(message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('â˜¢ï¸ Received deadzone update');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const deadzone = JSON.parse(message.body);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addDeadZone(deadzone.id, deadzone.latitude, deadzone.longitude,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â deadzone.radius, deadzone.name, deadzone.description);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stompClient.subscribe('/topic/deadzones-removed', function(message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ—‘ï¸ DeadZone removed:', message.body);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dzId = message.body;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removeDeadZone(dzId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }, function(error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ WebSocket connection error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('disconnected', '×©×’×™××ª ×—×™×‘×•×¨ WebSocket âš ï¸');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('connected-status').textContent = '×œ× âœ—';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showError('×œ× ×”×¦×œ×—×ª×™ ×œ×”×ª×—×‘×¨ ×œ-WebSocket. ×”×©×¨×ª ××•×œ×™ ×œ× ×ª×•××š ×‘-WebSocket.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(connectToServer, 5000);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error creating WebSocket:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×™×¦×™×¨×ª ×—×™×‘×•×¨ WebSocket: ' + error.message);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(connectToServer, 5000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function loadExistingForces() {
Â  Â  Â  Â  Â  Â  console.log('ğŸ“¥ Loading existing forces from server...');
Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/forces/all')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Response status:', response.status);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Server returned ' + response.status);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .then(forces => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Loaded', forces.length, 'forces');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forces.forEach(force => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addForce(force.id, force.latitude, force.longitude,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  force.type, force.name);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error loading forces:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×•×—×•×ª ×§×™×™××™×: ' + error.message);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×˜×¢×™× ×ª Dead Zones ×§×™×™××™×
Â  Â  Â  Â  Â  Â  console.log('ğŸ“¥ Loading existing deadzones from server...');
Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/deadzones/all')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  .then(deadzones => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Loaded', deadzones.length, 'deadzones');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deadzones.forEach(dz => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addDeadZone(dz.id, dz.latitude, dz.longitude,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dz.radius, dz.name, dz.description);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error loading deadzones:', error);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateStatus(status, text) {
Â  Â  Â  Â  Â  Â  const statusEl = document.getElementById('status');
Â  Â  Â  Â  Â  Â  statusEl.textContent = text;
Â  Â  Â  Â  Â  Â  statusEl.className = status;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderLayers() {
Â  Â  Â  Â  Â  Â  const layersDiv = document.getElementById('layers');
Â  Â  Â  Â  Â  Â  layersDiv.innerHTML = '';

Â  Â  Â  Â  Â  Â  for (const [key, layer] of Object.entries(layers)) {
Â  Â  Â  Â  Â  Â  Â  Â  if (key === 'deadzone') continue; // Dead Zones ×‘× ×¤×¨×“
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const layerDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  layerDiv.style.marginBottom = '10px';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×›×•×ª×¨×ª ×”×©×›×‘×”
Â  Â  Â  Â  Â  Â  Â  Â  const headerDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  headerDiv.className = 'layer-header' + (layer.visible ? ' active' : '');
Â  Â  Â  Â  Â  Â  Â  Â  headerDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; align-items: center; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="layer-checkbox" ${layer.visible ? 'checked' : ''}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onchange="toggleLayer('${key}')" onclick="event.stopPropagation()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="layer-toggle" onclick="toggleLayerExpand('${key}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${layer.expanded ? 'â–¼' : 'â–¶'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="layer-name">${layer.icon} ${layer.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="layer-count">${layer.markers.length} ×™×—×™×“×•×ª</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="color-indicator" style="background: ${layer.color}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×¨×©×™××ª ×”×›×•×—×•×ª
Â  Â  Â  Â  Â  Â  Â  Â  const forceListDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  forceListDiv.className = 'force-list' + (layer.expanded ? ' expanded' : '');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ××™×•×Ÿ ×”×›×•×—×•×ª ×œ×¤×™ ID
Â  Â  Â  Â  Â  Â  Â  Â  const sortedMarkers = Array.from(Object.entries(markers))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(([id, marker]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ××¦× ××ª ×”×¡×•×’ ×©×œ ×”×›×•×—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const [layerKey, layerData] of Object.entries(layers)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (layerData.markers.includes(marker)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return layerKey === key;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  sortedMarkers.forEach(([forceId, marker]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const forceDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceDiv.className = 'force-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceDiv.style.borderLeftColor = layer.color;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const latLng = marker.getLatLng();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const forceName = marker.options.title || forceId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const signalStrength = Math.max(0, 100 - Math.floor(Math.random() * 50)); // ×¡×™××•×œ×¦×™×™×ª ×¢×•×¦××ª ××•×ª
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="force-item-name">${layer.icon} ${forceName}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="force-item-id">ğŸ“ ${latLng.lat.toFixed(4)}, ${latLng.lng.toFixed(4)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class=force-item-id>ğŸ“¶ ×¢×•×¦××ª ××•×ª: ${signalStrength}%</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceDiv.onclick = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.setView([latLng.lat, latLng.lng], 15);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.openPopup();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceListDiv.appendChild(forceDiv);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  layerDiv.appendChild(headerDiv);
Â  Â  Â  Â  Â  Â  Â  Â  layerDiv.appendChild(forceListDiv);
Â  Â  Â  Â  Â  Â  Â  Â  layersDiv.appendChild(layerDiv);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Dead Zones ×‘× ×¤×¨×“
Â  Â  Â  Â  Â  Â  const dzLayer = layers['deadzone'];
Â  Â  Â  Â  Â  Â  const dzDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  dzDiv.style.marginBottom = '10px';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dzHeaderDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  dzHeaderDiv.className = 'layer-header' + (dzLayer.visible ? ' active' : '');
Â  Â  Â  Â  Â  Â  dzHeaderDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; align-items: center; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="layer-checkbox" ${dzLayer.visible ? 'checked' : ''}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onchange="toggleLayer('deadzone')" onclick="event.stopPropagation()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="layer-toggle" onclick="toggleLayerExpand('deadzone')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dzLayer.expanded ? 'â–¼' : 'â–¶'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="layer-name">${dzLayer.icon} ${dzLayer.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="layer-count">${Object.keys(deadzones).length} ××–×•×¨×™×</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="color-indicator" style="background: ${dzLayer.color}"></div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dzListDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  dzListDiv.className = 'force-list' + (dzLayer.expanded ? ' expanded' : '');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Object.entries(deadzones).forEach(([dzId, dz]) => {
Â  Â  Â  Â  Â  Â  Â  Â  const dzItemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  dzItemDiv.className = 'force-item';
Â  Â  Â  Â  Â  Â  Â  Â  dzItemDiv.style.borderLeftColor = dzLayer.color;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const latLng = dz.circle.getLatLng();
Â  Â  Â  Â  Â  Â  Â  Â  const dzName = dzId; // ×¦×¨×™×š ×œ×©××•×¨ ××ª ×”×©× ×‘××‘× ×”
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  dzItemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="force-item-name">â˜¢ï¸ ${dzName}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="force-item-id">×¨×“×™×•×¡: ${dz.circle.getRadius()}m</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="force-item-id">ğŸ“ ${latLng.lat.toFixed(4)}, ${latLng.lng.toFixed(4)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  dzItemDiv.onclick = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.setView([latLng.lat, latLng.lng], 13);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dz.circle.openPopup();
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  dzListDiv.appendChild(dzItemDiv);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dzDiv.appendChild(dzHeaderDiv);
Â  Â  Â  Â  Â  Â  dzDiv.appendChild(dzListDiv);
Â  Â  Â  Â  Â  Â  layersDiv.appendChild(dzDiv);
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleLayerExpand(layerKey) {
Â  Â  Â  Â  Â  Â  layers[layerKey].expanded = !layers[layerKey].expanded;
Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleLayer(layerKey) {
Â  Â  Â  Â  Â  Â  layers[layerKey].visible = !layers[layerKey].visible;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  layers[layerKey].markers.forEach(marker => {
Â  Â  Â  Â  Â  Â  Â  Â  if (layers[layerKey].visible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.addTo(map);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.remove();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  }

Â  Â  Â  Â  function createCustomIcon(color, icon) {
Â  Â  Â  Â  Â  Â  return L.divIcon({
Â  Â  Â  Â  Â  Â  Â  Â  className: 'force-marker',
Â  Â  Â  Â  Â  Â  Â  Â  html: `<div class="custom-icon" style="background-color: ${color}">${icon}</div>`,
Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [30, 30],
Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [15, 15],
Â  Â  Â  Â  Â  Â  Â  Â  popupAnchor: [0, -15]
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function addForce(id, lat, lng, type, name) {
Â  Â  Â  Â  Â  Â  // ×”××¨×ª ×¡×•×’×™× ×™×©× ×™× ×œ×—×“×©×™×
Â  Â  Â  Â  Â  Â  if (type === 'air' || type === 'logistics') {
Â  Â  Â  Â  Â  Â  Â  Â  type = 'other';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (markers[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  markers[id].setLatLng([lat, lng]);
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“ Updated force:', name);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const layer = layers[type];
Â  Â  Â  Â  Â  Â  Â  Â  if (!layer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Unknown force type:', type);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.marker([lat, lng], {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: createCustomIcon(layer.color, layer.icon),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: name
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong style="font-size: 16px;">${name}</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">×¡×•×’: ${layer.name}</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">××™×§×•×: ${lat.toFixed(5)}, ${lng.toFixed(5)}</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">×–××Ÿ ×¢×“×›×•×Ÿ: ${new Date().toLocaleString()}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">×—×•×–×§ ××•×ª: ${Math.max(0, 100 - Math.floor(Math.random() * 50))}%</span><br>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  marker.bindPopup(popupContent);

Â  Â  Â  Â  Â  Â  Â  Â  if (layer.visible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.addTo(map);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  markers[id] = marker;
Â  Â  Â  Â  Â  Â  Â  Â  layer.markers.push(marker);
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Added new force:', name);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×¢×“×›×Ÿ ×—×™×–×•×™ ××—×¨×™ ×”×•×¡×¤×ª ××™×§×•×
Â  Â  Â  Â  Â  Â  if (showPredictions) {
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => updatePrediction(id), 500);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function removeForce(id) {
Â  Â  Â  Â  Â  Â  if (markers[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  markers[id].remove();
Â  Â  Â  Â  Â  Â  Â  Â  delete markers[id];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  for (const layer of Object.values(layers)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.markers = layer.markers.filter(m => m !== markers[id]);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¡×¨ ××ª ×”×—×™×–×•×™
Â  Â  Â  Â  Â  Â  Â  Â  removePrediction(id);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ—‘ï¸ Removed force:', id);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ×¤×•× ×§×¦×™×•×ª ×—×™×–×•×™ ××¡×œ×•×œ
Â  Â  Â  Â  function updatePrediction(forceId) {
Â  Â  Â  Â  Â  Â  if (!showPredictions) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const predictionSeconds = parseInt(document.getElementById('prediction-time').value);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/trajectory/predict/' + forceId + '?seconds=' + predictionSeconds)
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('No prediction available');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .then(prediction => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  drawPrediction(forceId, prediction);
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('No prediction for ' + forceId + ':', error.message);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawPrediction(forceId, prediction) {
Â  Â  Â  Â  Â  Â  // ×”×¡×¨ ×—×™×–×•×™ ×§×•×“×
Â  Â  Â  Â  Â  Â  removePrediction(forceId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!prediction || !prediction.predictedPath || prediction.predictedPath.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×‘× ×” ××¢×¨×š ×©×œ × ×§×•×“×•×ª ×œ×§×•
Â  Â  Â  Â  Â  Â  const points = [[
Â  Â  Â  Â  Â  Â  Â  Â  prediction.currentPosition.latitude,
Â  Â  Â  Â  Â  Â  Â  Â  prediction.currentPosition.longitude
Â  Â  Â  Â  Â  Â  ]];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  prediction.predictedPath.forEach(pos => {
Â  Â  Â  Â  Â  Â  Â  Â  points.push([pos.latitude, pos.longitude]);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ××¦× ××ª ×”×¦×‘×¢ ×©×œ ×”×›×•×—
Â  Â  Â  Â  Â  Â  let forceColor = '#3498db';
Â  Â  Â  Â  Â  Â  for (const [key, layer] of Object.entries(layers)) {
Â  Â  Â  Â  Â  Â  Â  Â  if (key === 'deadzone') continue;
Â  Â  Â  Â  Â  Â  Â  Â  const forceMarker = markers[forceId];
Â  Â  Â  Â  Â  Â  Â  Â  if (forceMarker && layer.markers.includes(forceMarker)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceColor = layer.color;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×¦×™×™×¨ ×§×• ××§×•×•×§×•
Â  Â  Â  Â  Â  Â  const predictionLine = L.polyline(points, {
Â  Â  Â  Â  Â  Â  Â  Â  color: forceColor,
Â  Â  Â  Â  Â  Â  Â  Â  weight: 3,
Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.6,
Â  Â  Â  Â  Â  Â  Â  Â  dashArray: '10, 10',
Â  Â  Â  Â  Â  Â  Â  Â  smoothFactor: 1
Â  Â  Â  Â  Â  Â  }).addTo(map);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×•×¡×£ ×—×¥ ×‘×¡×•×£
Â  Â  Â  Â  Â  Â  const lastPoint = points[points.length - 1];
Â  Â  Â  Â  Â  Â  const arrowIcon = L.divIcon({
Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="color: ${forceColor}; font-size: 24px; transform: rotate(${prediction.heading}deg);">â¤</div>`,
Â  Â  Â  Â  Â  Â  Â  Â  className: '',
Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [24, 24],
Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [12, 12]
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const arrowMarker = L.marker(lastPoint, { icon: arrowIcon }).addTo(map);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Popup ×¢× ××™×“×¢
Â  Â  Â  Â  Â  Â  const popupContent = `
Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: right; direction: rtl; padding: 5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ğŸ”® ×—×™×–×•×™ ××¡×œ×•×œ</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 12px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ××”×™×¨×•×ª: ${(prediction.speed * 3.6).toFixed(1)} ×§×"×©<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ×›×™×•×•×Ÿ: ${prediction.heading.toFixed(0)}Â°<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ×‘×™×˜×—×•×Ÿ: ${(prediction.confidence * 100).toFixed(0)}%
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  predictionLine.bindPopup(popupContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×©××•×¨ ××ª ×”×§×• ×•×”×—×¥
Â  Â  Â  Â  Â  Â  predictionLines[forceId] = {
Â  Â  Â  Â  Â  Â  Â  Â  line: predictionLine,
Â  Â  Â  Â  Â  Â  Â  Â  arrow: arrowMarker
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log('ğŸ”® Drew prediction for ' + forceId);
Â  Â  Â  Â  }

Â  Â  Â  Â  function removePrediction(forceId) {
Â  Â  Â  Â  Â  Â  if (predictionLines[forceId]) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (predictionLines[forceId].line) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(predictionLines[forceId].line);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (predictionLines[forceId].arrow) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(predictionLines[forceId].arrow);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error removing prediction layers:', e);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  delete predictionLines[forceId];
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Removed prediction for:', forceId);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function togglePredictions() {
Â  Â  Â  Â  Â  Â  showPredictions = document.getElementById('show-predictions').checked;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (showPredictions) {
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¦×’ ××ª ×›×œ ×”×—×™×–×•×™×™×
Â  Â  Â  Â  Â  Â  Â  Â  for (const forceId of Object.keys(markers)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePrediction(forceId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¡×ª×¨ ××ª ×›×œ ×”×—×™×–×•×™×™×
Â  Â  Â  Â  Â  Â  Â  Â  for (const forceId of Object.keys(predictionLines)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removePrediction(forceId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updatePredictionTime(value) {
Â  Â  Â  Â  Â  Â  document.getElementById('prediction-time-label').textContent = value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×¢×“×›×Ÿ ××ª ×›×œ ×”×—×™×–×•×™×™× ×¢× ×”×–××Ÿ ×”×—×“×©
Â  Â  Â  Â  Â  Â  if (showPredictions) {
Â  Â  Â  Â  Â  Â  Â  Â  for (const forceId of Object.keys(markers)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePrediction(forceId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ×¢×“×›×•×Ÿ ×—×™×–×•×™×™× ××•×˜×•××˜×™ ×›×œ 5 ×©× ×™×•×ª
Â  Â  Â  Â  setInterval(() => {
Â  Â  Â  Â  Â  Â  if (showPredictions) {
Â  Â  Â  Â  Â  Â  Â  Â  for (const forceId of Object.keys(markers)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePrediction(forceId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 5000);

Â  Â  Â  Â  function addDeadZone(id, lat, lng, radius, name, description) {
Â  Â  Â  Â  Â  Â  if (deadzones[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  deadzones[id].circle.setLatLng([lat, lng]);
Â  Â  Â  Â  Â  Â  Â  Â  deadzones[id].circle.setRadius(radius);
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“ Updated deadzone:', name);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const layer = layers['deadzone'];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×™×¦×™×¨×ª ×¢×™×’×•×œ
Â  Â  Â  Â  Â  Â  Â  Â  const circle = L.circle([lat, lng], {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: layer.color,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: layer.color,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.3,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: radius,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // ×™×¦×™×¨×ª ××¨×›×– ×¢× ××™×™×§×•×Ÿ
Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.marker([lat, lng], {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: createCustomIcon(layer.color, layer.icon)
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong style="font-size: 16px; color: #e74c3c;">â˜¢ï¸ ${name}</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">×¨×“×™×•×¡: ${radius} ××˜×¨</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #555;">××™×§×•×: ${lat.toFixed(5)}, ${lng.toFixed(5)}</span><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<span style="color: #555;">×ª×™××•×¨: ${description}</span><br>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  circle.bindPopup(popupContent);
Â  Â  Â  Â  Â  Â  Â  Â  marker.bindPopup(popupContent);

Â  Â  Â  Â  Â  Â  Â  Â  if (layer.visible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  circle.addTo(map);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marker.addTo(map);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  deadzones[id] = { circle, marker };
Â  Â  Â  Â  Â  Â  Â  Â  layer.markers.push(circle);
Â  Â  Â  Â  Â  Â  Â  Â  layer.markers.push(marker);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Added new deadzone:', name, 'with radius:', radius);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  }

Â  Â  Â  Â  function removeDeadZone(id) {
Â  Â  Â  Â  Â  Â  if (deadzones[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  deadzones[id].circle.remove();
Â  Â  Â  Â  Â  Â  Â  Â  deadzones[id].marker.remove();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const layer = layers['deadzone'];
Â  Â  Â  Â  Â  Â  Â  Â  layer.markers = layer.markers.filter(m =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  m !== deadzones[id].circle && m !== deadzones[id].marker
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  delete deadzones[id];
Â  Â  Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ—‘ï¸ Removed deadzone:', id);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ×¤×•× ×§×¦×™×•×ª Modal ×œ×”×•×¡×¤×ª ×›×•×—
Â  Â  Â  Â  function openAddForceModal() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×§ ××“××™×Ÿ ×™×›×•×œ ×œ×”×•×¡×™×£ ×›×•×—×•×ª!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('add-force-modal').classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeAddForceModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('add-force-modal').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('force-name-input').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('force-location-preview').style.display = 'none';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×× ×‘×ª×”×œ×™×š ×‘×—×™×¨×ª ××™×§×•× - ×‘×˜×œ ××•×ª×•
Â  Â  Â  Â  Â  Â  if (isSelectingLocation) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('map-instruction').classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('selecting-mode');
Â  Â  Â  Â  Â  Â  Â  Â  map.off('click');
Â  Â  Â  Â  Â  Â  Â  Â  isSelectingLocation = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function selectLocationOnMap(type) {
Â  Â  Â  Â  Â  Â  isSelectingLocation = true;
Â  Â  Â  Â  Â  Â  locationCallback = type;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×¡×ª×¨ ××ª ×”××•×“×œ ×”× ×•×›×—×™
Â  Â  Â  Â  Â  Â  if (type === 'force') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-force-modal').classList.remove('active');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-deadzone-modal').classList.remove('active');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×¦×’ ×”×•×“×¢×” ×§×˜× ×” ×œ××¢×œ×”
Â  Â  Â  Â  Â  Â  const instruction = document.getElementById('map-instruction');
Â  Â  Â  Â  Â  Â  instruction.textContent = 'ğŸ‘† ×œ×—×¥ ×¢×œ ×”××¤×” ×œ×‘×—×™×¨×ª ××™×§×•× (ESC ×œ×‘×™×˜×•×œ)';
Â  Â  Â  Â  Â  Â  instruction.classList.add('active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×©× ×” ××ª ×”×¡××Ÿ ×œ×¦×œ×‘
Â  Â  Â  Â  Â  Â  document.body.classList.add('selecting-mode');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log('ğŸ“ Waiting for map click...');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×•×¡×¤×ª ×××–×™×Ÿ ×œ×—×™×¦×” ×¢×œ ×”××¤×”
Â  Â  Â  Â  Â  Â  const handleMapClick = function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ¯ Map clicked at:', e.latlng);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const lat = e.latlng.lat;
Â  Â  Â  Â  Â  Â  Â  Â  const lng = e.latlng.lng;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¡×ª×¨ ××ª ×”×”×•×“×¢×”
Â  Â  Â  Â  Â  Â  Â  Â  instruction.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('selecting-mode');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×¢×“×›×Ÿ ××ª ×”××™×§×•× ×‘-Modal ×”××ª××™×
Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'force') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('force-lat').textContent = lat.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('force-lng').textContent = lng.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('force-location-preview').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¦×’ ×©×•×‘ ××ª ×”××•×“×œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-force-modal').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-lat').textContent = lat.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-lng').textContent = lng.toFixed(6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-location-preview').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¦×’ ×©×•×‘ ××ª ×”××•×“×œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-deadzone-modal').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  isSelectingLocation = false;
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Location selected:', lat, lng);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×¡×¨ ××ª ×”×××–×™×Ÿ
Â  Â  Â  Â  Â  Â  Â  Â  map.off('click', handleMapClick);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×”×•×¡×£ ××ª ×”×××–×™×Ÿ
Â  Â  Â  Â  Â  Â  map.on('click', handleMapClick);
Â  Â  Â  Â  }

Â  Â  Â  Â  function submitForce() {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('force-name-input').value;
Â  Â  Â  Â  Â  Â  const type = document.getElementById('force-type-input').value;
Â  Â  Â  Â  Â  Â  const lat = parseFloat(document.getElementById('force-lat').textContent);
Â  Â  Â  Â  Â  Â  const lng = parseFloat(document.getElementById('force-lng').textContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!name) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('× × ×œ×”×–×™×Ÿ ×©× ×›×•×—');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isNaN(lat) || isNaN(lng)) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('× × ×œ×‘×—×•×¨ ××™×§×•× ×‘××¤×”');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const location = {
Â  Â  Â  Â  Â  Â  Â  Â  id: 'manual_' + Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  latitude: lat,
Â  Â  Â  Â  Â  Â  Â  Â  longitude: lng,
Â  Â  Â  Â  Â  Â  Â  Â  type: type,
Â  Â  Â  Â  Â  Â  Â  Â  name: name
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  console.log('ğŸ“¤ Sending manual force:', location);

Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/forces/update', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(location)
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Manual force sent successfully:', data);
Â  Â  Â  Â  Â  Â  Â  Â  closeAddForceModal();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error sending manual force:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×©×œ×™×—×ª ×›×•×—: ' + error.message);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // ×¤×•× ×§×¦×™×•×ª Modal ×œ×”×•×¡×¤×ª Dead Zone
Â  Â  Â  Â  function openAddDeadZoneModal() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×§ ××“××™×Ÿ ×™×›×•×œ ×œ×”×•×¡×™×£ Dead Zones!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('add-deadzone-modal').classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeAddDeadZoneModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('add-deadzone-modal').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-name-input').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-radius-input').value = '2000';
Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-description-input').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('deadzone-location-preview').style.display = 'none';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×× ×‘×ª×”×œ×™×š ×‘×—×™×¨×ª ××™×§×•× - ×‘×˜×œ ××•×ª×•
Â  Â  Â  Â  Â  Â  if (isSelectingLocation) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('map-instruction').classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('selecting-mode');
Â  Â  Â  Â  Â  Â  Â  Â  map.off('click');
Â  Â  Â  Â  Â  Â  Â  Â  isSelectingLocation = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function submitDeadZone() {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('deadzone-name-input').value;
Â  Â  Â  Â  Â  Â  const radius = parseFloat(document.getElementById('deadzone-radius-input').value);
Â  Â  Â  Â  Â  Â  const description = document.getElementById('deadzone-description-input').value;
Â  Â  Â  Â  Â  Â  const lat = parseFloat(document.getElementById('deadzone-lat').textContent);
Â  Â  Â  Â  Â  Â  const lng = parseFloat(document.getElementById('deadzone-lng').textContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!name) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('× × ×œ×”×–×™×Ÿ ×©× ××–×•×¨');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isNaN(radius) || radius < 100) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×“×™×•×¡ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 100 ××˜×¨');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isNaN(lat) || isNaN(lng)) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('× × ×œ×‘×—×•×¨ ××™×§×•× ×‘××¤×”');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const deadzone = {
Â  Â  Â  Â  Â  Â  Â  Â  id: 'dz_manual_' + Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  latitude: lat,
Â  Â  Â  Â  Â  Â  Â  Â  longitude: lng,
Â  Â  Â  Â  Â  Â  Â  Â  radius: radius,
Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  description: description || '××–×•×¨ ××¡×•×›×Ÿ'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  console.log('ğŸ“¤ Sending manual deadzone:', deadzone);

Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/deadzones/add', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(deadzone)
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Manual deadzone sent successfully:', data);
Â  Â  Â  Â  Â  Â  Â  Â  closeAddDeadZoneModal();
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error sending manual deadzone:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×©×œ×™×—×ª Dead Zone: ' + error.message);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function addTestForce() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×§ ××“××™×Ÿ ×™×›×•×œ ×œ×”×•×¡×™×£ ×›×•×—×•×ª!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const types = ['infantry', 'armor', 'artillery', 'other'];
Â  Â  Â  Â  Â  Â  const randomType = types[Math.floor(Math.random() * types.length)];
Â  Â  Â  Â  Â  Â  const randomId = 'test_' + Date.now();
Â  Â  Â  Â  Â  Â  const randomLat = 32.0853 + (Math.random() - 0.5) * 2;
Â  Â  Â  Â  Â  Â  const randomLng = 34.7818 + (Math.random() - 0.5) * 2;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const location = {
Â  Â  Â  Â  Â  Â  Â  Â  id: randomId,
Â  Â  Â  Â  Â  Â  Â  Â  latitude: randomLat,
Â  Â  Â  Â  Â  Â  Â  Â  longitude: randomLng,
Â  Â  Â  Â  Â  Â  Â  Â  type: randomType,
Â  Â  Â  Â  Â  Â  Â  Â  name: '×›×•×— ×‘×“×™×§×” ' + Math.floor(Math.random() * 100)
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  console.log('ğŸ“¤ Sending test force:', location);

Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/forces/update', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(location)
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Test force sent successfully:', data);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error sending test force:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×©×œ×™×—×ª ×›×•×— ×‘×“×™×§×”: ' + error.message);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function addTestDeadZone() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×§ ××“××™×Ÿ ×™×›×•×œ ×œ×”×•×¡×™×£ Dead Zones!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const randomId = 'dz_' + Date.now();
Â  Â  Â  Â  Â  Â  const randomLat = 32.0853 + (Math.random() - 0.5) * 2;
Â  Â  Â  Â  Â  Â  const randomLng = 34.7818 + (Math.random() - 0.5) * 2;
Â  Â  Â  Â  Â  Â  const randomRadius = 1000 + Math.random() * 4000; // 1-5 ×§"×
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const deadzone = {
Â  Â  Â  Â  Â  Â  Â  Â  id: randomId,
Â  Â  Â  Â  Â  Â  Â  Â  latitude: randomLat,
Â  Â  Â  Â  Â  Â  Â  Â  longitude: randomLng,
Â  Â  Â  Â  Â  Â  Â  Â  radius: randomRadius,
Â  Â  Â  Â  Â  Â  Â  Â  name: '××–×•×¨ ××¡×•×›×Ÿ ' + Math.floor(Math.random() * 100),
Â  Â  Â  Â  Â  Â  Â  Â  description: '××–×•×¨ ××¡×•×¨ ×œ×—×“×™×¨×” - ×‘×“×™×§×”'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  console.log('ğŸ“¤ Sending test deadzone:', deadzone);

Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/deadzones/add', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(deadzone)
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Test deadzone sent successfully:', data);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Error sending test deadzone:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError('×©×’×™××” ×‘×©×œ×™×—×ª Dead Zone: ' + error.message);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function clearAllForces() {
Â  Â  Â  Â  Â  Â  if (!isAdmin) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('×¨×§ ××“××™×Ÿ ×™×›×•×œ ×œ××—×•×§ ×›×•×—×•×ª!');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”×›×•×—×•×ª ×•-Dead Zones?')) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log('ğŸ§¹ Clearing everything...');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ×›×‘×” ×¢×“×›×•× ×™× ××•×˜×•××˜×™×™× ×©×œ ×—×™×–×•×™×™×
Â  Â  Â  Â  Â  Â  showPredictions = false;
Â  Â  Â  Â  Â  Â  document.getElementById('show-predictions').checked = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ××—×™×§×ª ×›×œ ×”×—×™×–×•×™×™× - ×‘×›×•×—
Â  Â  Â  Â  Â  Â  map.eachLayer(function(layer) {
Â  Â  Â  Â  Â  Â  Â  Â  // ××—×§ ×¨×§ polylines ×•-markers ×©×œ ×—×™×–×•×™×™× (×œ× ××ª ×©×›×‘×ª ×”××¤×” ×”×‘×¡×™×¡×™×ª)
Â  Â  Â  Â  Â  Â  Â  Â  if (layer instanceof L.Polyline && layer.options.dashArray) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(layer);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (layer instanceof L.Marker && layer.options.icon &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.options.icon.options.html &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.options.icon.options.html.includes('transform: rotate')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(layer);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  predictionLines = {};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ××—×™×§×ª ×›×œ ×”×¡×× ×™×
Â  Â  Â  Â  Â  Â  for (const id in markers) {
Â  Â  Â  Â  Â  Â  Â  Â  if (markers[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  markers[id].remove();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  markers = {};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ××—×™×§×ª dead zones
Â  Â  Â  Â  Â  Â  for (const id in deadzones) {
Â  Â  Â  Â  Â  Â  Â  Â  if (deadzones[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (deadzones[id].circle) deadzones[id].circle.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (deadzones[id].marker) deadzones[id].marker.remove();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  deadzones = {};
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // × ×™×§×•×™ ×”×©×›×‘×•×ª
Â  Â  Â  Â  Â  Â  for (const layer of Object.values(layers)) {
Â  Â  Â  Â  Â  Â  Â  Â  layer.markers = [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  renderLayers();
Â  Â  Â  Â  Â  Â  console.log('âœ… Map cleared locally');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ××—×™×§×” ××”×©×¨×ª
Â  Â  Â  Â  Â  Â  fetch(SERVER_URL + '/api/forces/all', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'DELETE'
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Server cleared');
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Server error:', error);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Reverse Geocoding - ×”××¨×ª ×§×•××•×¨×“×™× ×˜×•×ª ×œ×©× ××™×§×•×
Â  Â  Â  Â  let geocodeTimeout;
Â  Â  Â  Â  function updateLocationName(lat, lng) {
Â  Â  Â  Â  Â  Â  clearTimeout(geocodeTimeout);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  geocodeTimeout = setTimeout(function() {
Â  Â  Â  Â  Â  Â  Â  Â  fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=he`)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let locationName = '×œ× ×–×•×”×”';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.address) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parts = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.address.city) parts.push(data.address.city);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (data.address.town) parts.push(data.address.town);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (data.address.village) parts.push(data.address.village);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.address.road) parts.push(data.address.road);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (data.address.suburb) parts.push(data.address.suburb);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locationName = parts.length > 0 ? parts.join(', ') : data.display_name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('location-name').textContent = locationName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Geocoding error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('location-name').textContent = '×©×’×™××” ×‘×–×™×”×•×™ ××™×§×•×';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }, 500); // ×”××ª×Ÿ ×—×¦×™ ×©× ×™×™×” ×œ×¤× ×™ ×©×œ×™×—×ª ×‘×§×©×”
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleLayer = toggleLayer;
Â  Â  Â  Â  window.toggleLayerExpand = toggleLayerExpand;
Â  Â  Â  Â  window.login = login;
Â  Â  Â  Â  window.viewAsGuest = viewAsGuest;
Â  Â  Â  Â  window.logout = logout;
Â  Â  Â  Â  window.openAddForceModal = openAddForceModal;
Â  Â  Â  Â  window.closeAddForceModal = closeAddForceModal;
Â  Â  Â  Â  window.selectLocationOnMap = selectLocationOnMap;
Â  Â  Â  Â  window.submitForce = submitForce;
Â  Â  Â  Â  window.openAddDeadZoneModal = openAddDeadZoneModal;
Â  Â  Â  Â  window.closeAddDeadZoneModal = closeAddDeadZoneModal;
Â  Â  Â  Â  window.submitDeadZone = submitDeadZone;
Â  Â  Â  Â  window.togglePredictions = togglePredictions;
Â  Â  Â  Â  window.updatePredictionTime = updatePredictionTime;

Â  Â  Â  Â  // ×”×¤×¢×œ×ª ×”××¢×¨×›×ª
Â  Â  Â  Â  console.log('ğŸ“ Server URL:', SERVER_URL);
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', function() {
Â  Â  Â  Â  Â  Â  console.log('ğŸ“„ DOM loaded, initializing...');
Â  Â  Â  Â  Â  Â  setTimeout(initMap, 500);
Â  Â  Â  Â  });

Â  Â  Â  Â  // ×’× ×× DOM ×›×‘×¨ × ×˜×¢×Ÿ
Â  Â  Â  Â  if (document.readyState === 'complete' || document.readyState === 'interactive') {
Â  Â  Â  Â  Â  Â  setTimeout(initMap, 500);
Â  Â  Â  Â  }

Â  Â  Â  Â  // ×ª××™×›×” ×‘-Enter ×‘×˜×•×¤×¡ ×”×ª×—×‘×¨×•×ª
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', function() {
Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('password-input');
Â  Â  Â  Â  Â  Â  if (passwordInput) {
Â  Â  Â  Â  Â  Â  Â  Â  passwordInput.addEventListener('keypress', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  login();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // ×ª××™×›×” ×‘-ESC ×œ×‘×™×˜×•×œ ×‘×—×™×¨×ª ××™×§×•×
Â  Â  Â  Â  document.addEventListener('keydown', function(e) {
Â  Â  Â  Â  Â  Â  if (e.key === 'Escape' && isSelectingLocation) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('âŒ Location selection cancelled');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('map-instruction').classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.remove('selecting-mode');
Â  Â  Â  Â  Â  Â  Â  Â  map.off('click');
Â  Â  Â  Â  Â  Â  Â  Â  isSelectingLocation = false;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ×”×—×–×¨ ××ª ×”××•×“×œ ×”××ª××™×
Â  Â  Â  Â  Â  Â  Â  Â  if (locationCallback === 'force') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-force-modal').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-deadzone-modal').classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
